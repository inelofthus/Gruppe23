<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="no"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>addLecturesController.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">RateChill</a> &gt; <a href="index.source.html" class="el_package">gui</a> &gt; <span class="el_source">addLecturesController.java</span></div><h1>addLecturesController.java</h1><pre class="source lang-java linenums">package gui;

import java.io.IOException;
import java.net.URL;
import java.sql.SQLException;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.ResourceBundle;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import javafx.beans.value.ChangeListener;
import javafx.beans.value.ObservableValue;
import database.DBController;
import databaseobjects.Course;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.fxml.Initializable;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.scene.control.Button;
import javafx.scene.control.CheckBox;
import javafx.scene.control.DatePicker;
import javafx.scene.control.ListView;
import javafx.scene.control.TableColumn;
import javafx.scene.control.TextField;
import javafx.scene.layout.AnchorPane;
import javafx.scene.layout.GridPane;
import javafx.scene.paint.Color;
import javafx.scene.shape.Rectangle;
import javafx.scene.text.Text;
import javafx.stage.Stage;

<span class="nc" id="L37">public class addLecturesController implements Initializable {</span>


	

	// fxml objects
	
	@FXML
	public Button home;
	public Button back;
	public Button logout;
	public Button addLecture;
	public Button finish;
	public Button removeLectures;
	
	@FXML
	public TextField startTime;
	
	@FXML
	public DatePicker startDate;
	public DatePicker endDate;
	public DatePicker removeStart;
	public DatePicker removeEnd;
	
	@FXML 
	public CheckBox repeat;
	
	@FXML
	public Rectangle errorBar;
	
	@FXML
	public Text errorMessage;

	@FXML
	public ListView&lt;String&gt; listView;
	
<span class="nc" id="L73">	Course course = mainController.getInstance().getCourse();</span>
<span class="nc" id="L74">	String courseCode = course.getCourseCode();</span>
<span class="nc" id="L75">	String prof = mainController.getInstance().getProfessor().getUsername();</span>
<span class="nc" id="L76">	DBController dbc = new DBController(); </span>
	
	private Pattern pattern;
	private Matcher matcher;
	
	private static final String TIME24HOURS_PATTERN =
	           &quot;([01]?[0-9]|2[0-3]):[0-5][0-9]&quot;;


	public void loadNextScene(Button button, Stage stage, String string) throws IOException {
<span class="nc" id="L86">		stage = (Stage) button.getScene().getWindow();</span>
		Parent root;
<span class="nc" id="L88">		root = FXMLLoader.load(getClass().getResource(string));</span>

		// create a new scene with root and set the stage
<span class="nc" id="L91">		Scene scene = new Scene(root);</span>
<span class="nc" id="L92">		stage.setScene(scene);</span>
<span class="nc" id="L93">		stage.show();</span>
<span class="nc" id="L94">	}</span>

	public void userButtons(ActionEvent event, Stage stage) throws IOException {
<span class="nc bnc" id="L97" title="All 2 branches missed.">		if (event.getSource() == home) {</span>
<span class="nc" id="L98">			loadNextScene(home, stage, &quot;courseProf.fxml&quot;);</span>
		}
<span class="nc bnc" id="L100" title="All 2 branches missed.">		if (event.getSource() == back) {</span>
<span class="nc" id="L101">			loadNextScene(back, stage, &quot;lectureProf.fxml&quot;);</span>
			//loadNextScene(back, stage, mainController.getInstance().getStack().pop());
		}
<span class="nc bnc" id="L104" title="All 2 branches missed.">		if (event.getSource() == logout) {</span>
<span class="nc" id="L105">			loadNextScene(logout, stage, &quot;loginProf.fxml&quot;);</span>
		}
<span class="nc bnc" id="L107" title="All 2 branches missed.">		if (event.getSource() == finish) {</span>
<span class="nc" id="L108">			loadNextScene(logout, stage, &quot;lectureProf.fxml&quot;);</span>
		}
<span class="nc" id="L110">	}</span>



	@FXML
	private void handleButtonAction(ActionEvent event) throws IOException {
<span class="nc" id="L116">		Stage stage = null;</span>
<span class="nc" id="L117">		userButtons(event, stage);</span>
<span class="nc" id="L118">	}</span>
	
	@FXML
	private void submitAddLecture(ActionEvent event){
<span class="nc bnc" id="L122" title="All 4 branches missed.">		if (startDate.getValue() == null || startTime.getText().length() == 0 </span>
<span class="nc bnc" id="L123" title="All 6 branches missed.">				|| !validate(startTime.getText()) || (repeat.isSelected() &amp;&amp; endDate.getValue() == null)){</span>
<span class="nc" id="L124">			System.out.println(&quot;Feil&quot;);</span>
<span class="nc" id="L125">			String errorText = &quot;&quot;;</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">			if (startDate.getValue() == null){</span>
<span class="nc" id="L127">				System.out.println(&quot;Skriv inn dato&quot;);</span>
<span class="nc" id="L128">				errorText += &quot;Pick a date. &quot;;</span>
			}
<span class="nc bnc" id="L130" title="All 2 branches missed.">			if  (startTime.getText().length() == 0){</span>
<span class="nc" id="L131">				errorText += &quot;Pick a time. &quot;;</span>
			}
<span class="nc bnc" id="L133" title="All 2 branches missed.">			else if (!validate(startTime.getText())){</span>
<span class="nc" id="L134">				System.out.println(&quot;Feil klokkeslettformat&quot;);</span>
<span class="nc" id="L135">				errorText += &quot;Write time on format hh:mm. &quot;;</span>
			}
<span class="nc bnc" id="L137" title="All 4 branches missed.">			if (repeat.isSelected() &amp;&amp; endDate.getValue() == null){</span>
<span class="nc" id="L138">				errorText += &quot;Select an end date or uncheck weekly repetition. &quot;;</span>
			}
<span class="nc" id="L140">			errorBar.setFill(Color.RED);</span>
<span class="nc" id="L141">			errorMessage.setText(errorText);</span>
<span class="nc" id="L142">			errorBar.setVisible(true);</span>
			
<span class="nc" id="L144">		}</span>
		
		else{
<span class="nc bnc" id="L147" title="All 2 branches missed.">			if(!repeat.isSelected()){</span>
<span class="nc" id="L148">				endDate.setValue(startDate.getValue());</span>
			}
			try {
<span class="nc" id="L151">				course.addLectures(startTime.getText(), startDate.getValue().toString(), endDate.getValue().toString(), repeat.isSelected(), prof);</span>
<span class="nc" id="L152">				mainController.getInstance().setCourse(new Course(courseCode));</span>
<span class="nc" id="L153">				listView.getItems().clear();</span>
<span class="nc" id="L154">				listView.getItems().addAll(dbc.getLectureDateAndTimeForCourse(courseCode));</span>
<span class="nc" id="L155">				errorBar.setFill(Color.PALEGREEN);</span>
<span class="nc" id="L156">				errorMessage.setText(&quot;Lecture successfully added&quot;);</span>
<span class="nc" id="L157">				errorBar.setVisible(true);</span>
<span class="nc" id="L158">			} catch (SQLException e) {</span>
<span class="nc" id="L159">				System.out.println(&quot;Lecture already exists for this date and time&quot; + e.getMessage());</span>
<span class="nc" id="L160">				errorBar.setFill(Color.RED);</span>
<span class="nc" id="L161">				errorBar.setVisible(true);</span>
<span class="nc" id="L162">				errorMessage.setText(&quot;Lecture already exists for this date and time&quot;);</span>
<span class="nc" id="L163">			}</span>
		}
<span class="nc" id="L165">	}</span>
	
	@FXML
	public void removeLecturesInPeriod(ActionEvent e){
<span class="nc bnc" id="L169" title="All 4 branches missed.">		if (removeStart.getValue() == null || removeEnd.getValue() == null){</span>
<span class="nc" id="L170">			errorMessage.setText(&quot;Select a period&quot;);</span>
<span class="nc" id="L171">			errorBar.setFill(Color.RED);</span>
<span class="nc" id="L172">			errorBar.setVisible(true);</span>
			
		}
		else{
<span class="nc" id="L176">			dbc.deleteLecturesForPeriod(courseCode, removeStart.getValue().toString(), removeEnd.getValue().toString());</span>
<span class="nc" id="L177">			errorMessage.setText(&quot;Lectures successfully deleted&quot;);</span>
<span class="nc" id="L178">			errorBar.setFill(Color.PALEGREEN);</span>
<span class="nc" id="L179">			errorBar.setVisible(true);</span>
<span class="nc" id="L180">			listView.getItems().clear();</span>
<span class="nc" id="L181">			listView.getItems().addAll(dbc.getLectureDateAndTimeForCourse(courseCode));</span>
		}
<span class="nc" id="L183">	}</span>
	
	@FXML
	public void deleteLectureAction(ActionEvent e){
<span class="nc" id="L187">		String row = listView.getSelectionModel().getSelectedItem();</span>
<span class="nc" id="L188">		String[] rowArr = row.split(&quot;\t \t&quot;);</span>
<span class="nc" id="L189">		SimpleDateFormat fromUser = new SimpleDateFormat(&quot;dd.MM.yyyy&quot;);</span>
<span class="nc" id="L190">		SimpleDateFormat myFormat = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
		try {
<span class="nc" id="L192">			rowArr[0] = myFormat.format(fromUser.parse(rowArr[0]));</span>
<span class="nc" id="L193">		} catch (ParseException e1) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L195">			e1.printStackTrace();</span>
<span class="nc" id="L196">		}</span>
<span class="nc" id="L197">		ArrayList&lt;String&gt; dateTime = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L198">		dateTime.addAll(Arrays.asList(rowArr));</span>
<span class="nc" id="L199">		dbc.deleteLecture(dbc.getLectureID(dateTime, courseCode));</span>
<span class="nc" id="L200">		listView.getItems().clear();</span>
<span class="nc" id="L201">		listView.getItems().addAll(dbc.getLectureDateAndTimeForCourse(courseCode));</span>
<span class="nc" id="L202">		errorBar.setFill(Color.PALEGREEN);</span>
<span class="nc" id="L203">		errorMessage.setText(&quot;Lecture successfully deleted&quot;);</span>
<span class="nc" id="L204">		errorBar.setVisible(true);</span>
		
<span class="nc" id="L206">	}</span>
	
	public boolean validate(final String time){
<span class="nc" id="L209">	  matcher = pattern.matcher(time);</span>
<span class="nc" id="L210">	  return matcher.matches();</span>
	}
	
	
	
	@Override
	public void initialize(URL location, ResourceBundle resources) {
<span class="nc" id="L217">		pattern = Pattern.compile(TIME24HOURS_PATTERN);</span>
<span class="nc" id="L218">		ArrayList&lt;String&gt; lectures = dbc.getLectureDateAndTimeForCourse(courseCode);</span>
<span class="nc" id="L219">		listView.getItems().clear();</span>
<span class="nc" id="L220">		listView.getItems().addAll(lectures);</span>
		
		
<span class="nc" id="L223">		repeat.selectedProperty().addListener(new ChangeListener&lt;Boolean&gt;() {</span>
		    @Override
		    public void changed(ObservableValue&lt;? extends Boolean&gt; observable, Boolean oldValue, Boolean newValue) {
<span class="nc" id="L226">		    	endDate.setDisable(oldValue);</span>
<span class="nc" id="L227">		    	endDate.setValue(startDate.getValue());</span>
<span class="nc" id="L228">		    }</span>
		});
<span class="nc" id="L230">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>